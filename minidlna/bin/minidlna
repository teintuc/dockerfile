#!/bin/sh

set -e

DOCKER="/usr/bin/docker"

display_exit () {
  echo $1
  exit 1
}

if [ $# != 1 ]
then
  display_exit "Need to provide a directory to share"
fi

if [ ! -f $DOCKER ] || [ ! -x $DOCKER ]
then
  display_exit "Binary: ${DOCKER}: no such file or directory"
fi

if [ ! -d $1 ]
then
  display_exit "Directory: ${1}: no such file or directory"
fi

NAME="minidlna"
LOG_FILE="/tmp/minidlna"
CONTAINER_PORT=8200
CONTAINER_MEDIA="/media"
CONTAINER_IMAGE="teintuc/minidlna"

echo "Streaming under the name: ${HOSTNAME}"
$DOCKER run \
  --rm --name $NAME --net=host \
  -v $1:$CONTAINER_MEDIA \
  -e MINIDLNA_MEDIA_DIR=$CONTAINER_MEDIA \
  -e MINIDLNA_FRIENDLY_NAME=$HOSTNAME \
  $CONTAINER_IMAGE > $LOG_FILE

exit $?
